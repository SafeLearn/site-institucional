<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/dashboard.css" />
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="./imagens/logoSafePrint.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />

    <title>SafeLearn -- Dashboard</title>
  </head>

  <body>
    <span style="font-family: verdana, geneva, sans-serif">
      <!DOCTYPE html>
      <html lang="en">
        <head>
          <meta charset="UTF-8" />
          <title>Dashboard</title>
          <link rel="stylesheet" href="style.css" />
          <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
          />
        </head>

        <body>
          <div class="container">
            <nav>
              <ul>
                <li>
                  <a href="#" class="logo">
                    <img src="./imagens/logoSafePrint.png" alt="" />
                    <span class="nav-item">DashBoard</span>
                  </a>
                </li>
                <li>
                  <a href="./dashboard.html">
                    <i class="fas fa-home"></i>
                    <span class="nav-item">Home</span>
                  </a>
                </li>
                <li class="criarUsuarioNavegador">
                  <a href="./criaruser.html">
                    <i class="fas fa-user"></i>
                    <span class="nav-item">Usuários</span>
                  </a>
                </li>

                <li>
                  <a href="./monitorar.html">
                    <i class="fas fa-chart-bar"></i>
                    <span class="nav-item">Monitoramento</span>
                  </a>
                </li>
                <li>
                  <a href="./suporte.html">
                    <i class="fas fa-question-circle"></i>
                    <span class="nav-item">Suporte</span>
                  </a>
                </li>
                <li>
                  <a href="./home.html" class="logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="nav-item">Sair</span>
                  </a>
                </li>
              </ul>
            </nav>

            <section class="main">
              <div class="main-top">
                <h1>Home</h1>
                <i class="fas fa-user-cog"></i>
              </div>

              <div class="titulo">
                <h2 id="saudacoes"></h2>
                <p>Esses são os dados mais recentes de suas máquinas</p>
              </div>

              <div class="conteudo">
                <div class="indicadores">
                  <div class="card">
                    <div class="titulo">
                      <p>Visão Geral</p>
                      <div class="indicadores-cores">
                        <div class="indicador-verde"></div>
                        <p>Estável</p>
                        <div class="indicador-amarelo"></div>
                        <p>Alerta</p>

                        <div class="indicador-vermelho"></div>
                        <p>Risco</p>
                      </div>
                    </div>
                    <div class="lista-overview">
                      <span class="item-lista">
                        <p>Máquinas Ligadas:</p>
                        <p>10</p>
                        <div class="barra-status"></div>
                        <i class="fa-regular fa-eye" onclick="openModal('modal1')" data-modal-id="modal1"></i>
                      </span>
                      <span class="item-lista">
                        <p>Máquinas em risco:</p>
                        <p>5</p>
                        <div class="barra-status"></div>
                        <i class="fa-regular fa-eye" onclick="openModal('modal2')" data-modal-id="modal2"></i>
                      </span>
                      <span class="item-lista">
                        <p>Máquinas com pouca bateria:</p>
                        <p>2</p>
                        <div class="barra-status"></div>
                        <i class="fa-regular fa-eye" onclick="openModal('modal3')" data-modal-id="modal3"></i>
                      </span>
                    </div>
                  </div>
                  <div class="card">
                    <p>Status dos componentes por computador(%)</p>
                    <div class="titulo">
                      <span>Máquina</span>
                      <span>CPU</span>
                      <span>RAM</span>
                      <span>DISCO</span>
                      <span>BATERIA</span>
                    </div>
                    <div class="lista-maquinas"></div>
                  </div>
                  <!-- <div class="card">
                                <p>Máquinas com vida útil abaixo do recomendado:</p>
                                <span>5</span>
                                <p>Recomendado: 40%</p>
                            </div> -->
                </div>
                <div class="graficos">
                  <div class="card-grafico">
                    <div id="chart" style="width: 400px; height: 250px"></div>
                  </div>
                  <div class="card-grafico">
                    <div id="chart_div"></div>
                  </div>
                </div>
                <!-- <div class="graficos"></div> -->
              </div>

              <!-- modal de visão geral-->
              <div id="modal1" class="modal">
                <div class="modal-content">
                  <span class="fechar-modal" onclick="closeModal('modal1')">&times;</span>
                  <h2>Lista de Máquinas Ligadas</h2>
                  <ul>
                    <li>Máquina</li>
                    <li>Máquina</li>
                    <li>Máquina</li>
                    <li>Máquina</li>
                    <li>Máquina</li>
                    <li>Máquina</li>
                    <li>Máquina</li>
              </div>
            </div>

            <div id="modal2" class="modal">
                      <div class="modal-content">
                        <span class="fechar-modal" onclick="closeModal('modal2')">&times;</span>
                        <h2>Lista de Máquinas em risco</h2>
                        <ul>
                          <li>Máquina</li>
                          <li>Máquina</li>
                          <li>Máquina</li>
                          <li>Máquina</li>
                    </div>
               </div>

               <div id="modal3" class="modal">
                <div class="modal-content">
                  <span class="fechar-modal" onclick="closeModal('modal3')">&times;</span>
                  <h2>Lista de Máquinas com pouca bateria</h2>
                  <ul>
                    <li >Máquina</li>
                    <li>Máquina</li>
                    <li>Máquina</li>
                    <li>Máquina</li>
              </div>
            </div>


            </section>
          </div>
        </body>
      </html>
    </span>
  </body>
</html>

<script src="dashboardGrafico.js"></script>

<script>
  let saudacoes = document.getElementById("saudacoes");
  let botaoUsuario = document.querySelector('.criarUsuarioNavegador');
  let nivelAcesso = sessionStorage.NIVEL_ACESSO;

  if(nivelAcesso == "Baixo" || nivelAcesso == "Médio"){
    botaoUsuario.style.display = 'none';
  }

  saudacoes.innerHTML = `Bem-Vindo(a) de volta ${sessionStorage.USER_NAME}`;

</script>

<script>
  const components = [
    {
      MAQUINA: "01",
      CPU: 90,
      RAM: 80,
      DISCO: 70,
      BATERIA: 30,
      STATUS: "Ruim",
    },
    {
      MAQUINA: "02",
      CPU: 30,
      RAM: 40,
      DISCO: 10,
      BATERIA: 70,
      STATUS: "Bom",
    },
    {
      MAQUINA: "03",
      CPU: 60,
      RAM: 40,
      DISCO: 10,
      BATERIA: 10,
      STATUS: "Alerta",
    },
    {
      MAQUINA: "04",
      CPU: 90,
      RAM: 65,
      DISCO: 10,
      BATERIA: 90,
      STATUS: "Ruim",
    },
    {
      MAQUINA: "05",
      CPU: 10,
      RAM: 40,
      DISCO: 10,
      BATERIA: 100,
      STATUS: "Bom",
    },
  ];

  const order = [];

  function ultimaOcorrencia(lista, item) {
    for (let i = lista.length - 1; i >= 0; i--) {
      if (lista[i] && lista[i].STATUS === item) {
        return i;
      }
    }
    return -1;
  }

  function verificaEOrdenaPorStatusItem() {
    //let posicaoRuim = 0;
    //let posicaoAlerta = 0;
    //let posicaoBom = 0;

    for (let i = 0; i < components.length; i++) {
      let corStatus;
      const status = components[i].STATUS;

      switch (status) {
        case "Ruim":
          corStatus = "red";
          order.splice(i, 0, { ...components[i], corStatus });
          //posicaoRuim++;
          //posicaoAlerta++;
          //posicaoBom++;
          break;
        case "Alerta":
          corStatus = "yellow";
          order.splice(i, 0, { ...components[i], corStatus });
          //posicaoAlerta++;
          //posicaoBom++;
          break;
        case "Bom":
          corStatus = "green";
          order.splice(i, 0, { ...components[i], corStatus });
          //posicaoBom++;
          break;
        default:
          corStatus = "none";
      }
    }
  }

  const lista_maquinas = document.querySelector(".lista-maquinas");

  function createItem(item, i) {
    const div = document.createElement("div");
    div.classList.add("item-maquina");
    div.innerHTML = `
            <span>Máquina ${item.MAQUINA}</span>
            <span style="animation: piscar 1s infinite;">${item.CPU}%</span>
            <span>${item.RAM}%</span>
            <span>${item.DISCO}%</span>
            <span>${item.BATERIA}%</span>
        `;
    div.style.borderBottom = `6px solid ${item.corStatus}`;
    lista_maquinas.appendChild(div);
  }

  function updateList() {
    lista_maquinas.innerHTML = "";
    order.forEach(createItem);
  }

  verificaEOrdenaPorStatusItem();
  updateList();


//   modal
function openModal(modalId) {
    // Ocultar todos os modais
    var modais = document.querySelectorAll('.modal');
    modais.forEach(function(modal) {
      modal.style.display = 'none';
    });

    // Exibir o modal correspondente
    var modal = document.getElementById(modalId);
    if (modal) {
      modal.style.display = 'block';
    }
  }

  // Função para fechar todos os modais
  function closeModal(modalId) {
    var modal = document.getElementById(modalId);
    if (modal) {
      modal.style.display = 'none';
    }
  }


</script>
